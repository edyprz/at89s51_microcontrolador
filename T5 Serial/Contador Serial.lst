ENSAMBLADOR MCS51	OLVERA TECHNOLOGIES, 2004	16/03/2020 12:39:30

**** ENSAMBLANDO E:\PARA REPORTES-20200305T004811Z-001\PARA REPORTES\T5-COMUNICACIONSERIAL\CONTADOR SERIAL.ASM ****

0000         	1	LCD		EQU P0
0000         	2	RS		EQU P2.7
0000         	3	EN		EQU P2.6
0000         	4	UNIDADES	EQU 7FH
0000         	5	DECENAS	EQU 7EH	
0000         	6	CENTENAS	EQU 7DH
0000         	7	MILLARES	EQU 7CH
0000         	8	TEC		EQU 7BH
0000         	9	TIEMPO	EQU 7AH
0000         	10	SENTIDO	EQU 79H
0000         	11	
0000         	12		ORG 0H
0000 805E    	13		SJMP INICIO
0002         	14	;=============================================================
0023         	15		ORG 23H
0023 C2AF    	16		CLR EA	;DESHABILITA LAS INTERRUPCIONES
0025 C0E0    	17		PUSH ACC
0027 3098FD  	18		JNB RI,$
002A C298    	19		CLR RI
002C E599    	20		MOV A,SBUF
002E F57B    	21		MOV TEC,A
0030 1137    	22		ACALL REVISAT
0032 D2AF    	23		SETB EA		;HABILITA LAS INTERRUPCIONES
0034 D0E0    	24		POP ACC
0036 32      	25		RETI
0037         	26	
0037         	27	REVISAT:
0037 E57B    	28		MOV A,TEC
0039 B43104  	29		CJNE A,#'1',TI1
003C 757A01  	30		MOV TIEMPO,#1
003F 22      	31		RET
0040         	32	
0040 B43204  	33	TI1:	CJNE A,#'2',TI2
0043 757A40  	34		MOV TIEMPO,#64
0046 22      	35		RET
0047         	36	
0047 B43304  	37	TI2:	CJNE A,#'3',TI3
004A 757A80  	38		MOV TIEMPO,#128
004D 22      	39		RET
004E         	40	
004E B43404  	41	TI3:	CJNE A,#'4',TI4
0051 757AFF  	42		MOV TIEMPO,#255
0054 22      	43		RET
0055         	44	
0055         	45	TI4:
0055 B44404  	46		CJNE A,#'D',FIN
0058 757944  	47		MOV SENTIDO,#'D'
005B 22      	48		RET
005C         	49	FIN:
005C 757941  	50		MOV SENTIDO,#'A'
005F 22      	51		RET
0060         	52	;===========================================================
0060         	53	
0060         	54	INICIO:	
0060         	55	
0060 757AFF  	56		MOV	TIEMPO,#255
0063 757941  	57		MOV 	SENTIDO,#'A'
0066 316C    	58		ACALL INICIALIZA_LCD
0068 319E    	59		ACALL INI_UART
006A 117D    	60		ACALL BIENVENIDA
006C 11AA    	61		ACALL NLINEA
006E 3132    	62	INI:	ACALL INI1
0070         	63	
0070 313F    	64	IM:	ACALL IMPRIMEVALS
0072 3192    	65		ACALL RETARDO_1S
0074         	66	
0074         	67	REVISA_S:
0074 E579    	68		MOV A,SENTIDO
0076 B4417A  	69		CJNE A,#'A',DESCIENDE
0079 11B7    	70		ACALL ASCIENDE
007B         	71	
007B 80F3    	72		SJMP IM
007D         	73	
007D         	74	
007D         	75	
007D         	76	
007D         	77	
007D         	78	BIENVENIDA:
007D 11AA    	79			ACALL NLINEA
007F 9001B0  	80			MOV DPTR,#MSJA
0082 119C    	81			ACALL M
0084 11AA    	82			ACALL NLINEA
0086 9001C7  	83			MOV DPTR,#MSJB
0089 119C    	84			ACALL M
008B 11AA    	85			ACALL NLINEA
008D 9001F0  	86			MOV DPTR,#MSJC
0090 119C    	87			ACALL M
0092 11AA    	88			ACALL NLINEA
0094 900206  	89			MOV DPTR,#MSJD
0097 119C    	90			ACALL M
0099 11AA    	91			ACALL NLINEA
009B         	92	
009B 22      	93			RET
009C         	94	
009C         	95	M:
009C C2AF    	96			CLR EA	
009E E4      	97	B1:		CLR A	
009F 93      	98			MOVC A,@A+DPTR
00A0 6005    	99			JZ FINM
00A2 3164    	100			ACALL ENVIA
00A4 A3      	101			INC DPTR
00A5 80F7    	102			SJMP B1
00A7         	103	
00A7         	104	FINM:	
00A7 D2AF    	105			SETB EA
00A9 22      	106			RET
00AA         	107	
00AA         	108	NLINEA:
00AA C2AF    	109			CLR EA
00AC 740A    	110			MOV A,#0AH
00AE 3164    	111			ACALL ENVIA
00B0 740D    	112			MOV A,#0DH
00B2 3164    	113			ACALL ENVIA
00B4 D2AF    	114			SETB EA
00B6 22      	115			RET
00B7         	116	
00B7         	117	
00B7         	118	;===============================================================
00B7         	119	;======CUENTA ASCENDENTE========================================
00B7         	120	ASCIENDE:
00B7         	121	
00B7 11BA    	122		ACALL ADDUNI
00B9 22      	123		RET
00BA         	124	
00BA         	125	ADDUNI:	
00BA E57F    	126		MOV A,UNIDADES
00BC 04      	127		INC A
00BD B43A06  	128		CJNE A,#':',FUNI
00C0 757F30  	129		MOV UNIDADES,#'0'
00C3 11C9    	130		ACALL ADDDECE
00C5 22      	131		RET
00C6         	132	
00C6         	133	FUNI:
00C6 F57F    	134		MOV UNIDADES,A
00C8 22      	135		RET
00C9         	136	
00C9         	137	ADDDECE:
00C9 E57E    	138		MOV A,DECENAS
00CB 04      	139		INC A
00CC B43A06  	140		CJNE A,#':',FDEC
00CF 757E30  	141		MOV DECENAS,#'0'
00D2 11D8    	142		ACALL ADDCENTE
00D4 22      	143		RET
00D5         	144	
00D5         	145	FDEC:
00D5 F57E    	146		MOV DECENAS,A
00D7 22      	147		RET	
00D8         	148	
00D8         	149	
00D8         	150	ADDCENTE:
00D8 E57D    	151		MOV A,CENTENAS
00DA 04      	152		INC A
00DB B43A06  	153		CJNE A,#':',FCEN
00DE 757D30  	154		MOV CENTENAS,#'0'
00E1 11E7    	155		ACALL ADDMILLAR
00E3 22      	156		RET
00E4         	157	
00E4         	158	FCEN:
00E4 F57D    	159		MOV CENTENAS,A
00E6 22      	160		RET	
00E7         	161	
00E7         	162	
00E7         	163	
00E7         	164	ADDMILLAR:
00E7 E57C    	165		MOV A,MILLARES
00E9 04      	166		INC A
00EA B43A03  	167		CJNE A,#':',FMILL
00ED 3132    	168		ACALL INI1
00EF 22      	169		RET
00F0         	170	
00F0         	171	FMILL:
00F0 F57C    	172		MOV MILLARES,A
00F2 22      	173		RET	
00F3         	174	;===============================================================
00F3         	175	;======CUENTA DESCENDENTE========================================
00F3         	176	
00F3         	177	
00F3         	178	DESCIENDE:
00F3 11F8    	179		ACALL SUBBUNI
00F5 020070  	180		LJMP IM
00F8         	181	
00F8         	182	SUBBUNI:	
00F8 E57F    	183		MOV A,UNIDADES
00FA 14      	184		DEC A
00FB B42FC8  	185		CJNE A,#'/',FUNI
00FE 757F39  	186		MOV UNIDADES,#'9'
0101 3104    	187		ACALL SUBBDECE
0103 22      	188		RET
0104         	189	
0104         	190	
0104         	191	SUBBDECE:
0104 E57E    	192		MOV A,DECENAS
0106 14      	193		DEC A
0107 B42FCB  	194		CJNE A,#'/',FDEC
010A 757E39  	195		MOV DECENAS,#'9'
010D 3110    	196		ACALL SUBBCENTE
010F 22      	197		RET
0110         	198	
0110         	199	
0110         	200	SUBBCENTE:
0110 E57D    	201		MOV A,CENTENAS
0112 14      	202		DEC A
0113 B42FCE  	203		CJNE A,#'/',FCEN
0116 757D39  	204		MOV CENTENAS,#'9'
0119 311C    	205		ACALL SUBBMILLAR
011B 22      	206		RET
011C         	207	
011C         	208	
011C         	209	SUBBMILLAR:
011C E57C    	210		MOV A,MILLARES
011E 14      	211		DEC A
011F B42FCE  	212		CJNE A,#'/',FMILL
0122 3125    	213		ACALL INI2
0124 22      	214		RET
0125         	215		
0125         	216	INI2:
0125 757C39  	217		MOV MILLARES,#'9'
0128 757D39  	218		MOV CENTENAS,#'9'
012B 757E39  	219		MOV DECENAS,#'9'
012E 757F39  	220		MOV UNIDADES,#'9'
0131 22      	221		RET	
0132         	222		
0132         	223	
0132         	224	;====================================================
0132         	225	
0132         	226	
0132         	227	INI1:
0132 757C30  	228		MOV MILLARES,#'0'
0135 757D30  	229		MOV CENTENAS,#'0'
0138 757E30  	230		MOV DECENAS,#'0'
013B 757F30  	231		MOV UNIDADES,#'0'
013E 22      	232		RET
013F         	233	
013F         	234	IMPRIMEVALS:
013F C2AF    	235		CLR EA
0141         	236	
0141 740D    	237		MOV A,#0DH
0143 3164    	238		ACALL ENVIA
0145         	239	
0145 74C4    	240		MOV A,#0C4H
0147 317D    	241		ACALL CMD_LCD
0149 E57C    	242		MOV A,MILLARES
014B 3181    	243		ACALL ESCRIBE
014D 3164    	244		ACALL ENVIA
014F E57D    	245		MOV A,CENTENAS
0151 3181    	246		ACALL ESCRIBE
0153 3164    	247		ACALL ENVIA
0155         	248	
0155 E57E    	249		MOV A,DECENAS
0157 3181    	250		ACALL ESCRIBE
0159 3164    	251		ACALL ENVIA
015B         	252	
015B E57F    	253		MOV A,UNIDADES
015D 3181    	254		ACALL ESCRIBE
015F 3164    	255		ACALL ENVIA
0161 D2AF    	256		SETB EA
0163 22      	257		RET
0164         	258		
0164         	259	ENVIA:
0164 F599    	260		MOV SBUF,A
0166 3099FD  	261		JNB TI,$
0169 C299    	262		CLR TI
016B 22      	263		RET
016C         	264	
016C         	265	INICIALIZA_LCD:	
016C 7438    	266			MOV A,#38h	;FUNCTION SET
016E 317D    	267			ACALL CMD_LCD
0170 7401    	268			MOV A,#01h	; CLEAR LCD
0172 317D    	269			ACALL CMD_LCD
0174 740C    	270			MOV A,#0CH	
0176 317D    	271			ACALL CMD_LCD
0178 7480    	272			MOV A,#80H	
017A 317D    	273			ACALL CMD_LCD
017C 22      	274			RET 
017D         	275	
017D         	276	
017D         	277	CMD_LCD:
017D C2A7    	278		CLR RS
017F 8002    	279		SJMP ENABLE
0181         	280	
0181         	281	ESCRIBE:
0181 D2A7    	282		SETB RS
0183         	283		;MOV A,AUX
0183         	284	ENABLE:
0183 F580    	285		MOV LCD,A
0185 DFFE    	286		DJNZ R7,$
0187 DFFE    	287		DJNZ R7,$
0189 C2A6    	288		CLR EN
018B DFFE    	289		DJNZ R7,$
018D DFFE    	290		DJNZ R7,$
018F D2A6    	291		SETB EN
0191 22      	292		RET
0192         	293	
0192         	294	
0192 AE7A    	295	RETARDO_1S: MOV R6,TIEMPO
0194 DFFE    	296	RETARDO:	DJNZ R7, $
0196 DEFC    	297			DJNZ R6, RETARDO
0198 22      	298			RET
0199         	299			
0199         	300	RETARDITO: 
0199 DFFE    	301	RET1:		DJNZ R7, $
019B DEF7    	302			DJNZ R6, RETARDO
019D 22      	303			RET
019E         	304			
019E         	305	
019E         	306	;**********************************
019E         	307	; Rutina de configuracion de la UART
019E         	308	;---------------------------------------------
019E         	309	
019E         	310	
019E         	311	INI_UART:
019E 759850  	312		mov SCON,#50H ;transmisión en modo 1, habilita recepción serial
01A1 758920  	313		mov TMOD,#20H ;timer 1 en modo 2 autorrecargable
01A4 758DFD  	314		mov TH1,#0FDH ;baud_rate a 9600 @ 11.0592 MHz
01A7 758BFD  	315		mov TL1,#0FDH
01AA D28E    	316		setb TR1 ;inicia el baud_rate
01AC 75A890  	317		mov 	IE,#90H
01AF 22      	318		ret
01B0         	319	;---------------------------------------------
01B0 4249454E	320	MSJA:	DB 'BIENVENIDO, PRESIONE: ',0
01B4 56454E49
01B8 444F2C20
01BC 50524553
01C0 494F4E45
01C4 3A2000  
01C7 56454C4F	321	MSJB:	DB 'VELOCIDAD: 1(MAS RAPIDO) - 4(MAS LENTO):',0
01CB 43494441
01CF 443A2031
01D3 284D4153
01D7 20524150
01DB 49444F29
01DF 202D2034
01E3 284D4153
01E7 204C454E
01EB 544F293A
01EF 00      
01F0 413A2043	322	MSJC:	DB 'A: CUENTA ASCENDENTE ',0
01F4 55454E54
01F8 41204153
01FC 43454E44
0200 454E5445
0204 2000    
0206 443A2043	323	MSJD:	DB 'D: CUENTA DESCENDENTE',0
020A 55454E54
020E 41204445
0212 5343454E
0216 44454E54
021A 4500    


---- TABLA DE SIMBOLOS ----

LCD         	0080
RS          	00A7
EN          	00A6
UNIDADES    	007F
DECENAS     	007E
CENTENAS    	007D
MILLARES    	007C
TEC         	007B
TIEMPO      	007A
SENTIDO     	0079


---- TABLA DE ETIQUETAS ----

REVISAT     	0037
TI1         	0040
TI2         	0047
TI3         	004E
TI4         	0055
FIN         	005C
INICIO      	0060
INI         	006E
IM          	0070
REVISA_S    	0074
BIENVENIDA  	007D
M           	009C
B1          	009E
FINM        	00A7
NLINEA      	00AA
ASCIENDE    	00B7
ADDUNI      	00BA
FUNI        	00C6
ADDDECE     	00C9
FDEC        	00D5
ADDCENTE    	00D8
FCEN        	00E4
ADDMILLAR   	00E7
FMILL       	00F0
DESCIENDE   	00F3
SUBBUNI     	00F8
SUBBDECE    	0104
SUBBCENTE   	0110
SUBBMILLAR  	011C
INI2        	0125
INI1        	0132
IMPRIMEVALS 	013F
ENVIA       	0164
INICIALIZA_L	016C
CMD_LCD     	017D
ESCRIBE     	0181
ENABLE      	0183
RETARDO_1S  	0192
RETARDO     	0194
RETARDITO   	0199
RET1        	0199
INI_UART    	019E
MSJA        	01B0
MSJB        	01C7
MSJC        	01F0
MSJD        	0206


**** ERRORES 0, DIRECCION FINAL 0206H, BYTES USADOS 485 ****
