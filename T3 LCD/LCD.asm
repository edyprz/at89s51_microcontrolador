SELECT	EQU P0.0
LCD		EQU P1
RS		EQU P3.1
EN		EQU P3.0
UNIDADES	EQU 7FH
DECENAS	EQU 7EH	
CENTENAS	EQU 7DH
MILLARES	EQU 7CH
AUX		EQU 7BH

	ORG 0H
	ACALL INICIALIZA_LCD



EDOINI:	
	MOV UNIDADES,#'0'
	MOV DECENAS,#'0'
	MOV CENTENAS,#'0'
	MOV MILLARES,#'0'

CHECK:
;===============================================
;SE CREA UN IF ELSE PARA LOS SWITCHES DE VELOCIDAD
LEE1:
	JB P2.0,LEE2
	JNB P2.0,LEE3
LEE2:
	JB P2.1,VEL3	;11
	JNB P2.1,VEL2	;10
LEE3:		JB P2.1,VEL1	;01
	JNB P2.1,VEL1	;00

VEL1:
	MOV AUX,#10
	SJMP ASODS
VEL2:
	MOV AUX,#60
	SJMP ASODS
VEL3:
	MOV AUX,#150
	SJMP ASODS
VEL4:
	MOV AUX,#255
	SJMP ASODS

;======REVISAMOS EL SWITCH DE ASCENDENTE DESCENDENTE=====================================
ASODS:
	JB SELECT,ASCE
	JNB SELECT,DESCE

ASCE:
	MOV A,#80H
	ACALL CMD_LCD
	MOV DPTR,#INCRE
	ACALL MSJA
	SJMP ASCIENDE
MSJA:	CLR A
	MOVC A,@A+DPTR
	JZ FIN
	ACALL ESCRIBE
	INC DPTR
	SJMP MSJA
FIN:	RET

ASCIENDE:
	
	MOV A,#0C4H		;POSICION EL LA LCD
	ACALL CMD_LCD
	ACALL IMPRIME
	ACALL RETARDITO
	ACALL ADDUNI
	SJMP CHECK

ADDUNI:
	MOV A,UNIDADES
	INC A
	MOV UNIDADES,A
	SUBB A,#'9'
	JZ ADDDECE
	RET

ADDDECE:
	MOV UNIDADES,#'0'
	MOV A,DECENAS
	INC A
	MOV DECENAS,A
	SUBB A,#':'
	JZ ADDCEN
	RET

ADDCEN:
	MOV UNIDADES,#'0'
	MOV DECENAS,#'0'
	MOV A,CENTENAS
	INC A
	MOV CENTENAS,A
	SUBB A,#':'
	JZ ADDMILLAR
	RET

ADDMILLAR:
	MOV UNIDADES,#'0'
	MOV DECENAS,#'0'
	MOV CENTENAS,#'0'
	MOV A,MILLARES
	INC A
	MOV MILLARES,A
	SUBB A,#':'
	JZ INI
	RET
INI:
	LJMP EDOINI	

;=========CUENTA DESCENDENTE===============================

DESCE:
	MOV A,#80H
	ACALL CMD_LCD
	MOV DPTR,#DECRE
	ACALL MSJD
	SJMP DESCIENDE
MSJD:	CLR A
	MOVC A,@A+DPTR
	JZ FIND
	ACALL ESCRIBE
	INC DPTR
	SJMP MSJA
FIND:	RET

DESCIENDE:
	MOV A,#0C4H		;POSICION EL LA LCD
	ACALL CMD_LCD
	ACALL IMPRIME
	ACALL RETARDITO
	ACALL SUBBUNI
	LJMP CHECK

SUBBUNI:
	MOV A,UNIDADES
	SUBB A,#'0'
	JZ SUBBDECE
	MOV A,UNIDADES
	DEC A
	MOV UNIDADES,A
	RET

SUBBDECE:
	MOV UNIDADES,#'9'
	MOV A,DECENAS
	SUBB A,#'0'
	JZ SUBBCEN
	MOV A,DECENAS
	DEC A
	MOV DECENAS,A
	SJMP DESCIENDE

SUBBCEN:
	MOV UNIDADES,#'9'
	MOV DECENAS,#'9'
	MOV A,CENTENAS
	SUBB A,#'0'
	JZ SUBBMILLAR
	MOV A,CENTENAS
	DEC A
	MOV CENTENAS,A
	SJMP DESCIENDE

SUBBMILLAR:
	MOV UNIDADES,#'9'
	MOV DECENAS,#'9'
	MOV CENTENAS,#'9'
	MOV A,MILLARES
	SUBB A,#'0'
	JZ ININEGA
	MOV A,MILLARES
	DEC A
	MOV MILLARES,A
	SJMP DESCIENDE

ININEGA:
	MOV UNIDADES,#'9'
	MOV DECENAS,#'9'
	MOV CENTENAS,#'9'
	MOV MILLARES,#'9'
	SJMP DESCIENDE

;=======RUTINAS DE SERVICIO=================================
RETARDITO:	
		MOV R6,AUX
R:		DJNZ	R7,$
		DJNZ	R6,R
		RET

IMPRIME:
	MOV A,MILLARES
	ACALL ESCRIBE
	ACALL RETARDITO
	MOV A,CENTENAS
	ACALL ESCRIBE
	ACALL RETARDITO
	MOV A,DECENAS
	ACALL ESCRIBE
	ACALL RETARDITO
	MOV A,UNIDADES
	ACALL ESCRIBE
	ACALL RETARDITO
	RET


INICIALIZA_LCD:	
		MOV A,#38h	;FUNCTION SET
		ACALL CMD_LCD
		MOV A,#01h	; CLEAR LCD
		ACALL CMD_LCD
		MOV A,#0CH	
		ACALL CMD_LCD
		MOV A,#80H	
		ACALL CMD_LCD
		RET 


CMD_LCD:
	CLR RS
	SJMP ENABLE

ESCRIBE:
	SETB RS
ENABLE:
	MOV LCD,A
	DJNZ R7,$
	DJNZ R7,$
	CLR EN
	DJNZ R7,$
	DJNZ R7,$
	SETB EN
	RET



INCRE:	DB 'CUENTA ASCENDENTE:',0
DECRE:	DB 'CUENTA DESCENDENTE:',0