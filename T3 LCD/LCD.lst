ENSAMBLADOR MCS51	OLVERA TECHNOLOGIES, 2004	16/03/2020 14:06:43

**** ENSAMBLANDO E:\PARA REPORTES-20200305T004811Z-001\PARA REPORTES\T3-LCD\LCD.ASM ****

0000         	1	SELECT	EQU P0.0
0000         	2	LCD		EQU P1
0000         	3	RS		EQU P3.1
0000         	4	EN		EQU P3.0
0000         	5	UNIDADES	EQU 7FH
0000         	6	DECENAS	EQU 7EH	
0000         	7	CENTENAS	EQU 7DH
0000         	8	MILLARES	EQU 7CH
0000         	9	AUX		EQU 7BH
0000         	10	
0000         	11		ORG 0H
0000 312D    	12		ACALL INICIALIZA_LCD
0002         	13	
0002         	14	
0002         	15	
0002         	16	EDOINI:	
0002 757F30  	17		MOV UNIDADES,#'0'
0005 757E30  	18		MOV DECENAS,#'0'
0008 757D30  	19		MOV CENTENAS,#'0'
000B 757C30  	20		MOV MILLARES,#'0'
000E         	21	
000E         	22	CHECK:
000E         	23	;===============================================
000E         	24	;SE CREA UN IF ELSE PARA LOS SWITCHES DE VELOCIDAD
000E         	25	LEE1:
000E 20A003  	26		JB P2.0,LEE2
0011 30A006  	27		JNB P2.0,LEE3
0014         	28	LEE2:
0014 20A113  	29		JB P2.1,VEL3	;11
0017 30A10B  	30		JNB P2.1,VEL2	;10
001A 20A103  	31	LEE3:		JB P2.1,VEL1	;01
001D 30A100  	32		JNB P2.1,VEL1	;00
0020         	33	
0020         	34	VEL1:
0020 757B0A  	35		MOV AUX,#10
0023 800F    	36		SJMP ASODS
0025         	37	VEL2:
0025 757B3C  	38		MOV AUX,#60
0028 800A    	39		SJMP ASODS
002A         	40	VEL3:
002A 757B96  	41		MOV AUX,#150
002D 8005    	42		SJMP ASODS
002F         	43	VEL4:
002F 757BFF  	44		MOV AUX,#255
0032 8000    	45		SJMP ASODS
0034         	46	
0034         	47	;======REVISAMOS EL SWITCH DE ASCENDENTE DESCENDENTE=====================================
0034         	48	ASODS:
0034 208003  	49		JB SELECT,ASCE
0037 30805E  	50		JNB SELECT,DESCE
003A         	51	
003A         	52	ASCE:
003A 7480    	53		MOV A,#80H
003C 313E    	54		ACALL CMD_LCD
003E 900153  	55		MOV DPTR,#INCRE
0041 1145    	56		ACALL MSJA
0043 800A    	57		SJMP ASCIENDE
0045 E4      	58	MSJA:	CLR A
0046 93      	59		MOVC A,@A+DPTR
0047 6005    	60		JZ FIN
0049 3142    	61		ACALL ESCRIBE
004B A3      	62		INC DPTR
004C 80F7    	63		SJMP MSJA
004E 22      	64	FIN:	RET
004F         	65	
004F         	66	ASCIENDE:
004F         	67		
004F 74C4    	68		MOV A,#0C4H		;POSICION EL LA LCD
0051 313E    	69		ACALL CMD_LCD
0053 3114    	70		ACALL IMPRIME
0055 310D    	71		ACALL RETARDITO
0057 115B    	72		ACALL ADDUNI
0059 80B3    	73		SJMP CHECK
005B         	74	
005B         	75	ADDUNI:
005B E57F    	76		MOV A,UNIDADES
005D 04      	77		INC A
005E F57F    	78		MOV UNIDADES,A
0060 9439    	79		SUBB A,#'9'
0062 6001    	80		JZ ADDDECE
0064 22      	81		RET
0065         	82	
0065         	83	ADDDECE:
0065 757F30  	84		MOV UNIDADES,#'0'
0068 E57E    	85		MOV A,DECENAS
006A 04      	86		INC A
006B F57E    	87		MOV DECENAS,A
006D 943A    	88		SUBB A,#':'
006F 6001    	89		JZ ADDCEN
0071 22      	90		RET
0072         	91	
0072         	92	ADDCEN:
0072 757F30  	93		MOV UNIDADES,#'0'
0075 757E30  	94		MOV DECENAS,#'0'
0078 E57D    	95		MOV A,CENTENAS
007A 04      	96		INC A
007B F57D    	97		MOV CENTENAS,A
007D 943A    	98		SUBB A,#':'
007F 6001    	99		JZ ADDMILLAR
0081 22      	100		RET
0082         	101	
0082         	102	ADDMILLAR:
0082 757F30  	103		MOV UNIDADES,#'0'
0085 757E30  	104		MOV DECENAS,#'0'
0088 757D30  	105		MOV CENTENAS,#'0'
008B E57C    	106		MOV A,MILLARES
008D 04      	107		INC A
008E F57C    	108		MOV MILLARES,A
0090 943A    	109		SUBB A,#':'
0092 6001    	110		JZ INI
0094 22      	111		RET
0095         	112	INI:
0095 020002  	113		LJMP EDOINI	
0098         	114	
0098         	115	;=========CUENTA DESCENDENTE===============================
0098         	116	
0098         	117	DESCE:
0098 7480    	118		MOV A,#80H
009A 313E    	119		ACALL CMD_LCD
009C 900166  	120		MOV DPTR,#DECRE
009F 11A3    	121		ACALL MSJD
00A1 800A    	122		SJMP DESCIENDE
00A3 E4      	123	MSJD:	CLR A
00A4 93      	124		MOVC A,@A+DPTR
00A5 6005    	125		JZ FIND
00A7 3142    	126		ACALL ESCRIBE
00A9 A3      	127		INC DPTR
00AA 8099    	128		SJMP MSJA
00AC 22      	129	FIND:	RET
00AD         	130	
00AD         	131	DESCIENDE:
00AD 74C4    	132		MOV A,#0C4H		;POSICION EL LA LCD
00AF 313E    	133		ACALL CMD_LCD
00B1 3114    	134		ACALL IMPRIME
00B3 310D    	135		ACALL RETARDITO
00B5 11BA    	136		ACALL SUBBUNI
00B7 02000E  	137		LJMP CHECK
00BA         	138	
00BA         	139	SUBBUNI:
00BA E57F    	140		MOV A,UNIDADES
00BC 9430    	141		SUBB A,#'0'
00BE 6006    	142		JZ SUBBDECE
00C0 E57F    	143		MOV A,UNIDADES
00C2 14      	144		DEC A
00C3 F57F    	145		MOV UNIDADES,A
00C5 22      	146		RET
00C6         	147	
00C6         	148	SUBBDECE:
00C6 757F39  	149		MOV UNIDADES,#'9'
00C9 E57E    	150		MOV A,DECENAS
00CB 9430    	151		SUBB A,#'0'
00CD 6007    	152		JZ SUBBCEN
00CF E57E    	153		MOV A,DECENAS
00D1 14      	154		DEC A
00D2 F57E    	155		MOV DECENAS,A
00D4 80D7    	156		SJMP DESCIENDE
00D6         	157	
00D6         	158	SUBBCEN:
00D6 757F39  	159		MOV UNIDADES,#'9'
00D9 757E39  	160		MOV DECENAS,#'9'
00DC E57D    	161		MOV A,CENTENAS
00DE 9430    	162		SUBB A,#'0'
00E0 6007    	163		JZ SUBBMILLAR
00E2 E57D    	164		MOV A,CENTENAS
00E4 14      	165		DEC A
00E5 F57D    	166		MOV CENTENAS,A
00E7 80C4    	167		SJMP DESCIENDE
00E9         	168	
00E9         	169	SUBBMILLAR:
00E9 757F39  	170		MOV UNIDADES,#'9'
00EC 757E39  	171		MOV DECENAS,#'9'
00EF 757D39  	172		MOV CENTENAS,#'9'
00F2 E57C    	173		MOV A,MILLARES
00F4 9430    	174		SUBB A,#'0'
00F6 6007    	175		JZ ININEGA
00F8 E57C    	176		MOV A,MILLARES
00FA 14      	177		DEC A
00FB F57C    	178		MOV MILLARES,A
00FD 80AE    	179		SJMP DESCIENDE
00FF         	180	
00FF         	181	ININEGA:
00FF 757F39  	182		MOV UNIDADES,#'9'
0102 757E39  	183		MOV DECENAS,#'9'
0105 757D39  	184		MOV CENTENAS,#'9'
0108 757C39  	185		MOV MILLARES,#'9'
010B 80A0    	186		SJMP DESCIENDE
010D         	187	
010D         	188	;=======RUTINAS DE SERVICIO=================================
010D         	189	RETARDITO:	
010D AE7B    	190			MOV R6,AUX
010F DFFE    	191	R:		DJNZ	R7,$
0111 DEFC    	192			DJNZ	R6,R
0113 22      	193			RET
0114         	194	
0114         	195	IMPRIME:
0114 E57C    	196		MOV A,MILLARES
0116 3142    	197		ACALL ESCRIBE
0118 310D    	198		ACALL RETARDITO
011A E57D    	199		MOV A,CENTENAS
011C 3142    	200		ACALL ESCRIBE
011E 310D    	201		ACALL RETARDITO
0120 E57E    	202		MOV A,DECENAS
0122 3142    	203		ACALL ESCRIBE
0124 310D    	204		ACALL RETARDITO
0126 E57F    	205		MOV A,UNIDADES
0128 3142    	206		ACALL ESCRIBE
012A 310D    	207		ACALL RETARDITO
012C 22      	208		RET
012D         	209	
012D         	210	
012D         	211	INICIALIZA_LCD:	
012D 7438    	212			MOV A,#38h	;FUNCTION SET
012F 313E    	213			ACALL CMD_LCD
0131 7401    	214			MOV A,#01h	; CLEAR LCD
0133 313E    	215			ACALL CMD_LCD
0135 740C    	216			MOV A,#0CH	
0137 313E    	217			ACALL CMD_LCD
0139 7480    	218			MOV A,#80H	
013B 313E    	219			ACALL CMD_LCD
013D 22      	220			RET 
013E         	221	
013E         	222	
013E         	223	CMD_LCD:
013E C2B1    	224		CLR RS
0140 8002    	225		SJMP ENABLE
0142         	226	
0142         	227	ESCRIBE:
0142 D2B1    	228		SETB RS
0144         	229	ENABLE:
0144 F590    	230		MOV LCD,A
0146 DFFE    	231		DJNZ R7,$
0148 DFFE    	232		DJNZ R7,$
014A C2B0    	233		CLR EN
014C DFFE    	234		DJNZ R7,$
014E DFFE    	235		DJNZ R7,$
0150 D2B0    	236		SETB EN
0152 22      	237		RET
0153         	238	
0153         	239	
0153         	240	
0153 4355454E	241	INCRE:	DB 'CUENTA ASCENDENTE:',0
0157 54412041
015B 5343454E
015F 44454E54
0163 453A00  
0166 4355454E	242	DECRE:	DB 'CUENTA DESCENDENTE:',0
016A 54412044
016E 45534345
0172 4E44454E
0176 54453A00


---- TABLA DE SIMBOLOS ----

SELECT      	0080
LCD         	0090
RS          	00B1
EN          	00B0
UNIDADES    	007F
DECENAS     	007E
CENTENAS    	007D
MILLARES    	007C
AUX         	007B


---- TABLA DE ETIQUETAS ----

EDOINI      	0002
CHECK       	000E
LEE1        	000E
LEE2        	0014
LEE3        	001A
VEL1        	0020
VEL2        	0025
VEL3        	002A
VEL4        	002F
ASODS       	0034
ASCE        	003A
MSJA        	0045
FIN         	004E
ASCIENDE    	004F
ADDUNI      	005B
ADDDECE     	0065
ADDCEN      	0072
ADDMILLAR   	0082
INI         	0095
DESCE       	0098
MSJD        	00A3
FIND        	00AC
DESCIENDE   	00AD
SUBBUNI     	00BA
SUBBDECE    	00C6
SUBBCEN     	00D6
SUBBMILLAR  	00E9
ININEGA     	00FF
RETARDITO   	010D
R           	010F
IMPRIME     	0114
INICIALIZA_L	012D
CMD_LCD     	013E
ESCRIBE     	0142
ENABLE      	0144
INCRE       	0153
DECRE       	0166


**** ERRORES 0, DIRECCION FINAL 0166H, BYTES USADOS 358 ****
